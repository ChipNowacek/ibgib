echo "Running post_start..."

set +e

while true; do
  nodetool ping
  EXIT_CODE=$?
  if [ $EXIT_CODE -eq 0 ]; then
    echo "Application is up!"
    break
  fi
done

set -e


echo "Running Elixir.IbGib.Release.Tasks migrate..."
bin/ib_gib_umb rpc Elixir.IbGib.Release.Tasks migrate
echo "migrate complete."

echo "Running Elixir.IbGib.Release.Tasks seed..."
bin/ib_gib_umb rpc Elixir.IbGib.Release.Tasks seed
echo "seed complete."

echo "Running Elixir.WebGib.Release.Tasks migrate..."
bin/ib_gib_umb rpc Elixir.WebGib.Release.Tasks migrate
echo "migrate complete."

echo "post_start complete."
